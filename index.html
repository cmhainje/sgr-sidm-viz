<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>sidm + sgr</title>
  <style>
    body {
      margin: 0;
    }

    .controls {
      text-align: center;
      /* width: fit-content;
      margin: 0 auto; */
    }
  </style>
</head>

<body>
  <main>
    <h1>sidm + sgr</h1>

    <video src="/movies/cdm_movie.mp4" width="49%" style="display: inline;"></video>
    <video src="/movies/sidm_movie.mp4" width="49%" style="display: inline;"></video>
    <div class="controls">
      <button type="button" id="playstart">play (start together)</button>
      <button type="button" id="playend">play (end together)</button>
      <button type="button" id="restart">restart</button>
      <br>
      <label>
        speed (<span id="currentspeed">1x</span>)
        <input type="range" id="playspeed" min="0" max="200" step="10" value="100">
      </label>
    </div>

    <p>
      <a href="/snapshots/">view the final high-resolution snapshots of the streams in 3D!</a>
    </p>
  </main>

  <script type="module">
    const playBtn = document.getElementById("playstart");
    const endBtn = document.getElementById("playend");
    const restBtn = document.getElementById("restart");
    const videos = Array.from(document.getElementsByTagName("video"));
    const speed = document.getElementById("playspeed");
    const speedtext = document.getElementById("currentspeed");

    let maxDuration = 0;
    videos.forEach(v => {
      v.addEventListener('loadedmetadata', () => {
        maxDuration = Math.max(maxDuration, v.duration);
      });
    });

    playBtn.addEventListener("click", () => {
      videos.forEach(v => {
        v.play();
      });
    });

    endBtn.addEventListener("click", () => {
      videos.forEach(v => {
        setTimeout(() => { v.play() }, (maxDuration - v.duration) * 1000)
      });
    });

    restBtn.addEventListener("click", () => {
      videos.forEach(v => {
        v.pause();
        v.currentTime = 0;
      })
    })

    speed.addEventListener("change", (e) => {
      const s = e.target.value / 100;
      videos.forEach(v => {
        v.playbackRate = s;
        speedtext.innerText = `${s}x`
      })
    })
  </script>
</body>

</html>